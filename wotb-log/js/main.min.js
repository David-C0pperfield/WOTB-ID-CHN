const reg={datetime:/blitz-logs_(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/,platform:/Platform:\s*(.*)/,id_name:/"dbid":([0-9]+)\S*"name":"([^"]+)/,phone_num:/\{"mobile_num":"([0-9]+-[0-9]+)","updated_at":(\d+)\}/,gpu_model:/GetGPUModel\(\):\s*(.*)/,device_tags:/Device tags:\s*\[(.*)\]/,device_kind:/Device kind:\s*(.*)/,device_display:/Device display:\s*(.*)/,network_type:/Network type:\s*(.*)/,device_resolution:/Default Framebuffer size:\s*(.*)/,isDynamicResolutionSupported:/isDynamicResolutionSupported:\s*(.*)/,timezone:/Timezone:\s*(.*)/,app_ver:/Application version:\s*(.*)/,build_ver:/Build version:\s*(.*)/,locale_info:/InitializeLocalizations device locale:\s*(\S*), locale:\s*(\S*), game locale:\s*(\S*), sound locale:\s*(\S*),/},tr={Android:"安卓",Phone:"手机",Desktop:"桌面",manufacturer:"制造商",maxFps:"最大帧率",NETWORK_TYPE_WIFI:"Wi-Fi",NETWORK_TYPE_LTE:"LTE",netease:"网易"};String.prototype.tr=function(){var str=this;for(let i in tr){let reg=new RegExp("\\b"+i,"g");str=str.replace(reg,tr[i])}return str},$((function(){function getFile(){var objFile=$("#upload_file").prop("files");return objFile.length?objFile:void alert("请上传文件")}function readFile(f){if(f){var file=f,log_text="",reader=new FileReader,filename=file[0].name;reader.readAsText(file[0],"utf-8"),reader.onload=function(){log_text=reader.result;var analysis=new Analysis(filename,log_text);$("#raw_data").html(log_text.replace(/\n/g,"<br />")),analysis.demo("#processed_data .content")}}}$("#submit").on("click",(function(){processData()}));class Analysis{constructor(filename,rawdata){this.filename=filename,this._rawdata=rawdata}getUid(){return"ID："+this._rawdata.match(reg.id_name)[1]}getUsername(){return"昵称："+this._rawdata.match(reg.id_name)[2]}getPhone(){try{var updated_time=new Date(1e3*Number(this._rawdata.match(reg.phone_num)[2]))||"";return"手机号："+this._rawdata.match(reg.phone_num)[1]+"（更新于："+updated_time.toLocaleString()+"）"}catch(e){return}}getPlatform(){return"平台："+this._rawdata.match(reg.platform)[1].tr()}getDeviceTags(){return"设备信息："+this._rawdata.match(reg.device_tags)[1].tr()}getDeviceType(){return"设备类型："+this._rawdata.match(reg.device_kind)[1].tr()}getNetworkType(){return"网络："+this._rawdata.match(reg.network_type)[1].tr()}getGPU(){return"GPU："+this._rawdata.match(reg.gpu_model)[1]}getResolution(){return"设备分辨率："+this._rawdata.match(reg.device_resolution)[1]}getDisplaySize(){return"屏幕尺寸："+this._rawdata.match(reg.device_display)[1]}getAppVer(){return"应用版本："+this._rawdata.match(reg.app_ver)[1]}getBuildVer(){return"编译版本："+this._rawdata.match(reg.build_ver)[1]}getLocaleInfo(){var device_lang,locale,game_lang,sound_lang;return"本地化信息：\n设备语言："+this._rawdata.match(reg.locale_info)[1]+"\n本地化："+this._rawdata.match(reg.locale_info)[2]+"\n游戏语言："+this._rawdata.match(reg.locale_info)[3]+"\n系别成员语音："+this._rawdata.match(reg.locale_info)[4]+"\n"}demo(indicator){var processed,output=[this.getUid(),this.getUsername(),this.getPhone(),this.getPlatform(),this.getNetworkType(),this.getDeviceTags(),this.getDeviceType(),this.getDisplaySize(),this.getResolution(),this.getGPU(),this.getAppVer(),this.getBuildVer(),this.getLocaleInfo(),getDateTimeFromFile(this.filename)].join("\n");$(indicator).val(output)}}function getDateTimeFromFile(f_n){var filename=f_n,unit=["年","月","日","时","分","秒"],output="";for(let i=1;i<=6;i++)output+=filename.match(reg.datetime)[i]+unit[i-1];return output}function processData(){var f;readFile(getFile())}$("#copy_btn").on("click",(function(){$("#processed_data .content").select(),document.execCommand("Copy")}))}));