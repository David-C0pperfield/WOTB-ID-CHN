$((function(){var clanData,beginIndex=0,stepLength=20,endingIndex=beginIndex+20-1,dataIndex=beginIndex,overflowIndex=0,overflowStep=0,fileExtList={1:"png",2:"jpg",3:"jpg"},rLogo=[];for(let i=0;i<=24;i++)rLogo.push(1e4+i);for(let i=2;i<=26;i++)rLogo.push(2e4+i);function fetchData(){if(restorePosition(),!clanData)return!1;var total_entries=clanData.length;changeTitle("收录",total_entries),function judgePage(){beginIndex<=0?$(".flipBtn.prev").hide():$(".flipBtn.prev").show(),endingIndex>=total_entries-1?$(".flipBtn.next").hide():$(".flipBtn.next").show()}(),function loadList(){for($("#content tbody").empty(),beginIndex<0&&(endingIndex=(beginIndex=0)+20-1),endingIndex>total_entries-1&&(overflowStep=(overflowIndex=endingIndex)-(endingIndex=total_entries-1)),0!=overflowStep&&(endingIndex+=overflowStep,overflowStep=0);dataIndex>=beginIndex&&dataIndex<=endingIndex;){if(insertData(clanData,dataIndex,"table"),!(dataIndex<total_entries-1))return;dataIndex++}}()}function slideDownAnnouncement(){setTimeout((function(){$("#announcement_zone").slideDown(250)}),450)}$('meta[itemprop="image"]').attr("content",window.location.protocol+"//"+window.location.host+"/favicon.ico"),$.ajaxSetup({async:!1}),$.ajax({url:"./js/clan.json",dataType:"json",error:function(){console.log("数据获取失败")},success:function(data){clanData=data}}),calcTableHeight(),$(window).resize((function(){calcTableHeight()})),getClanData("byId",getQueryStr("cid")),getQueryStr("keyword")&&($("#searchstr").val(getQueryStr("keyword")),startSearching()),$(document).on("click",".flipBtn.back",(function(){dataIndex=beginIndex,$(".flipBtn.back").hide(),window.history.replaceState({Page:1},"","./"),$("table.clan_lib").css("display","none"),$("#recommend").css("display","block"),showRecommend()})),$(".flipBtn.next").on("click",(function(){endingIndex+=20,dataIndex=beginIndex+=20,fetchData()})),$(".flipBtn.prev").on("click",(function(){endingIndex+=-20,dataIndex=beginIndex+=-20,fetchData()})),$(document).on("keydown",(function(e){var keyFind=e.which;(e.ctrlKey||e.metaKey)&&70==keyFind&&(e.preventDefault(),$("#searchstr").focus(),$("#searchstr").select(),restoreDetailWindow())})),$("#search_btn").on("click",(function(){$("#searchstr").val()&&startSearching()})),$(".btn.resetBtn>*").on("click",(function(){removeInput("#searchstr"),$("#searchstr").focus()})),$("#searchstr").on("click focus",(function(){$("#announcement_zone").slideDown(250),this.select()})),$("#searchstr").on("keydown",(function(e){var key;13==e.which&&startSearching()})),$(document).on("click",(function(e){var target=$(e.target);(!target.is("#searchstr")&&!target.is("#announcement_zone .wrap")&&!target.is("#announcement_zone .wrap *")||target.is("#announcement_zone .toCollapse")||target.is("#announcement_zone .toCollapse *"))&&slideUpAnnouncement()})),$(document).on("click","#content tbody tr[data-clan-id],.clan-card[data-clan-id]",(function(){let cid=$(this).attr("data-clan-id");window.history.pushState({Page:3},"","?cid="+cid),getClanData("byId",getQueryStr("cid")),showDetail()})),$(document).on("mousedown","#content tbody tr[data-clan-id]",(function(e){1==e.which&&$(this).css({"background-color":"rgba(70, 94, 109, 0.5)"})})),$(document).on("mouseup","#content tbody tr[data-clan-id]",(function(){$(this).removeAttr("style")})),$(document).on("click","#detail .clanFamily [data-clan-id]",(function(){let cid=$(this).attr("data-clan-id");window.history.pushState({Page:4},"","?cid="+cid),$("#detail .content").fadeOut(250),setTimeout((function(){$("#detail .content>*").remove(),getClanData("byId",getQueryStr("cid"))}),200),showDetail(),$("#detail .content").fadeIn(350)})),$("#detail").on("click keydown",(function(e){let target=$(e.target);target.is("#detail .inner *")&&!target.is("#detail .dismissBtn *")||restoreDetailWindow()}));var beginDrag_y,drag_distance=0,element_ceil_position,element_ceil_position_end,element_move_distance,scroll_flag=!1;function restoreDetailWindow(){window.history.replaceState({Page:1},"","./"),$("#detail .inner").animate({height:"0"},{queue:!1,duration:500}),$("#detail").fadeOut(600,(function(){$("#detail .content").empty(),$("#detail .window").css({transform:"translateY(0px)"})})),document.title="闪击战ID大百科",$('meta[itemprop="name"').attr("content","闪击战ID大百科"),$('meta[name="description"],meta[itemprop="description"]').attr("content","本网页旨在帮助国服玩家刊载军团简介。有意见或建议请加Q群：715200589"),$('meta[itemprop="image"]').attr("content",window.location.protocol+"//"+window.location.host+"/favicon.ico")}function startSearching(){$("#searchstr").val()?(window.history.pushState({Page:2},"","?keyword="+$("#searchstr").val()),$("#recommend").css("display","none"),$("table.clan_lib").css("display","block"),restorePosition(),getClanData()):alert("您还没有输入关键词！")}function slideUpAnnouncement(){"none"!=$("#announcement_zone").css("display")&&$("#announcement_zone").slideUp(250)}function getClanData(mode,id){if(mode){if(mode.match(/byID/gi)){var id,detail;if((0==(id=String(id))||id%1!=0)&&!id.match(/隐藏/g))return;let len;if(0==(detail=toCompare(id,clanData,"id")).length)return;insertData(detail,0,"detail"),document.title="["+detail[0].Tag+"] "+detail[0].Full+"——闪击战ID百科",$('meta[itemprop="name"]').attr("content","["+detail[0].Tag+"] "+detail[0].Full+"——闪击战ID百科"),detail[0].Desc?$('meta[name="description"],meta[itemprop="description"]').attr("content",detail[0].Desc):$('meta[name="description"],meta[itemprop="description"]').attr("content","本网页旨在帮助国服玩家刊载军团简介。有意见或建议请加Q群：715200589"),showDetail()}}else{var keyword=getQueryStr("keyword");if(!keyword)return;$("#content tbody").empty();let result=toCompare(keyword,clanData),resultCount=result.length;0==resultCount&&insertData(),changeTitle("搜索到",resultCount);for(let i in result)insertData(result,i,"table");let backIcon='<svg width="1em" height="1em" viewBox="0 0 16 16" class="bi bi-chevron-left" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M11.354 1.646a.5.5 0 0 1 0 .708L5.707 8l5.647 5.646a.5.5 0 0 1-.708.708l-6-6a.5.5 0 0 1 0-.708l6-6a.5.5 0 0 1 .708 0z"/></svg>';slideUpAnnouncement(),$(".flipBtn").hide(),$("#title-banner").prepend('<span class="btn flipBtn back">'+backIcon+"返回</span>"),$(".flipBtn.back").show()}}function getClanFamily(i){var parentClan,result=toCompare(i,clanData,"mid"),family_branch=[];$("#detail .content").append('<div class="clanFamily"><h3>相关军团</h3></div>');for(let i in result)family_branch[i]=toCompare(result[i].ID,clanData,"mid")[0],family_branch[i]&&family_branch[i].ID==family_branch[i].MID&&(family_branch[i]=toCompare(-result[i].ID,clanData,"mid")[0]);for(let i in result)insertData(result,i,"mid",family_branch[i])}$("#detail .content").on("touchstart",(function(e){beginDrag_y=e.touches[0].pageY})),$("#detail .content").on("touchmove",(function(e){page_y=e.touches[0].pageY,drag_distance=page_y-beginDrag_y,32!=element_ceil_position||scroll_flag||$("#detail .window").css({transform:"translateY("+.1875*drag_distance+"px)"})})),$("#detail .content").on("touchend",(function(e){32==(element_ceil_position=$(this).position().top)&&(scroll_flag=!1),console.log(drag_distance),drag_distance<-.2*$("#detail .wrap .inner .window").height()&&(scroll_flag=!0),drag_distance>128&&32==element_ceil_position&&!scroll_flag?(restoreDetailWindow(),drag_distance=0):$("#detail .window").css({transform:"translateY(0px)"})}));var filter=["[","]","{","}","(",")","+","*","/"],filter_factor="\\",filterWords=["编者","幽灵团","孤儿"],blacklist=[],repeated_desc;for(let i in filterWords)blacklist.push(new RegExp(filterWords[i],"g"));for(let i=0;i<filter.length;i++)filter[i]="\\"+filter[i];function toCompare(keyword,data,mode){switch(keyword){case!keyword:break;default:if(isNaN(Number(keyword)))for(let i in keyword)for(let j in filter)filtSpecial=new RegExp(filter[j],"g"),keyword=keyword.replace(filtSpecial,filter[j]);var strictReg=new RegExp("^"+keyword+"$")}if(data instanceof Array){var len=data.length,arr=[],reg=new RegExp(keyword,"i");switch(mode){case"id":for(let i=0;i<len;i++)String(data[i].ID).match(strictReg)&&arr.push(data[i]);break;case"mid":for(let i=0;i<len;i++)String(data[i].MID).match(strictReg)&&arr.push(data[i]);break;case"analysis":let z=0;for(let i=0;i<len;i++){var tempDesc=String(data[i].Desc);tempDesc.match(/\/repeat/g)&&(tempDesc=toRepeat(data[i].MID,tempDesc)),tempDesc.length>10&&!tempDesc.match(/^编者/g)&&!tempDesc.match(/幽灵团/g)&&tempDesc.match(/\d/g)&&(arr.push(data[i]),z++)}break;default:for(let i=0;i<len;i++)(String(data[i].Tag).match(reg)||String(data[i].Full).match(reg)||String(data[i].ID).match(strictReg||reg))&&arr.push(data[i])}return arr}}function changeTitle(action,number){number?$("#title-banner .title").html("共"+action+number+"个军团"):$("#title-banner .title").html(action)}function insertData(d,i,method,family_branch){if(!d)return void $("#content tbody").append("<tr><td>未搜索到相关内容，相关军团可能未被收录</td></tr>");var ID=d[i=i||0].ID,Tag="["+d[i].Tag+"]",Full=d[i].Full,tableID;if(d[i].hasOwnProperty("Desc"))var desc=d[i].Desc;else desc="无";if(d[i].hasOwnProperty("MID"))var MID=d[i].MID;if(d[i].hasOwnProperty("Logo"))var logoExt=d[i].Logo;let insertHTML;switch(method){case"table":var reDesc;(reDesc=toRepeat(MID,desc))&&(desc=reDesc.Desc),desc.length>20?desc=desc.substr(0,19)+"…":tableID=ID,insertHTML="<tr data-clan-id="+ID+"><td>"+ID+'</td><td class="orange">'+Tag+" "+Full+"</td><td>"+desc+"</td></tr>",$("#content tbody").append(insertHTML);break;case"detail":var logoURL="",imgDisplay="",reDesc,clanBrief,clanIntro;if(d[i].hasOwnProperty("Imgs"))var imgList=d[i].Imgs;if(logoExt)logoURL="img/clan/"+ID+"/0."+fileExtList[logoExt];else{let LogoID=parseInt(Math.random()*rLogo.length);logoURL="img/icons/clanEmblems2x/clan-icon-v2-"+rLogo[LogoID]+".png"}if($('meta[itemprop="image"]').attr("content",window.location.protocol+"//"+window.location.host+"/"+logoURL),d[i].Date)var estbl=processDate(d[i].Date);else estbl="--";if(imgList){imgDisplay='<div class="clan-img"><div class = "container">';for(let i=0;i<imgList.length;i++)imgDisplay+='<li><img src="./img/clan/'+ID+"/"+(i+1)+"."+fileExtList[imgList[i]]+'"></li>';imgDisplay+="</div></div>"}(reDesc=toRepeat(MID,desc))&&(desc=reDesc.Desc),insertHTML='<div class="clanInfo"><div class="logo"> <img src="'+logoURL+'" alt="'+Tag+Full+'Logo"></div><div class="info"><p class="orange">'+Tag+" "+Full+"</p><p>ID："+ID+"</p><p>创建日期："+estbl+"</p></div></div>"+imgDisplay+('<div class="introduction"><h3>简介</h3><p>'+(desc=desc.replace(/\n/g,"</p><p>"))+"</p></div>"),$("#detail .content").append(insertHTML),MID&&(MID<0&&(MID=-MID),getClanFamily(MID)),repeated_desc="";break;case"mid":let beginMark='<div><div data-clan-id="'+ID+'">';var clan_cell='<span class="orange">'+Tag+" "+Full+'</span><span class="idNumber">ID：'+ID+"</span>";let endMark="</div></div>";ID==getQueryStr("cid")&&(beginMark='<div data-clan-id="'+ID+'"class ="current">'),insertHTML=[beginMark,clan_cell,endMark].join(""),$("#detail .clanFamily").append(insertHTML)}}function removeInput(t){$(t).val("")}function calcTableHeight(){return tablePosition=$(window).height()-$("table thead").outerHeight()-$("#content #title-banner").outerHeight()-$("#head").outerHeight(),$("table tbody").css({height:tablePosition+"px"}),tablePosition}function getQueryStr(n){let reg=new RegExp("(^|&)"+n+"=([^&]*)(&|$)"),result=window.location.search.substr(1).match(reg);if(!result)return;let decodeR=decodeURIComponent(result[2]);return decodeR?null!=result?decodeR:null:void 0}function restorePosition(){$("table tbody").animate({scrollTop:0},{queue:!1,duration:500})}function showDetail(){$("#detail .inner").animate({height:"100%"},{queue:!1,duration:450}),$("#detail").fadeIn(400),scroll_flag=!1}function processDate(rd){let rDate=rd,processedDate,result;return date=new Date,date.setFullYear(1900),date.setMonth(0),date.setDate(rDate-1),[date.getFullYear(),Number(date.getMonth()+1),date.getDate()].join("-")}function toRepeat(MID,Desc){var descOut,iconOut,picOut,output,re_reg=/\/repeat(\(([^)]*)\))?/;if(!Desc.match(re_reg))return null;Desc.match(re_reg)[2]&&(MID=Desc.match(re_reg)[2]);var temp=toCompare(MID,clanData,"id");return temp[0].hasOwnProperty("Desc")&&(descOut=Desc.replace(re_reg,temp[0].Desc)),{Icon:void 0,Desc:descOut,Pic:void 0}}var indexList=new Array,recommendList=toCompare(void 0,clanData,"analysis");function randomNum(){var rand;return parseInt(Math.random()*recommendList.length)}function showRecommend(){var clan,ID,tag,fname,Desc,rand,logo,date,logoURL,family_list=[];$("#recommend").empty(),changeTitle("军团推荐");do{rand=randomNum(),-1==$.inArray(rand,indexList)&&(recommendList[rand].hasOwnProperty("MID")&&-1!=$.inArray(recommendList[rand].MID,family_list)||(indexList.push(rand),family_list.push(recommendList[rand].MID)))}while(indexList.length<5);for(let i in indexList){if(logo=null,ID=(clan=recommendList[indexList[i]]).ID,tag="["+clan.Tag+"]",fname=clan.Full,desc=clan.Desc,clan.hasOwnProperty("MID"))var MID=clan.MID;if(date=clan.hasOwnProperty("Date")?['<span class="date">创建于：<span class="desc-color">',date=processDate(clan.Date),"</span></span>"].join(""):"",clan.hasOwnProperty("Logo")&&(logo=clan.Logo),logo)logoURL='<img src="img/clan/'+ID+"/0."+fileExtList[logo]+'">';else{let LogoID=parseInt(Math.random()*rLogo.length);logoURL='<img src="img/icons/clanEmblems1x/clan-icon-v2-'+rLogo[LogoID]+'.png">'}toRepeat(MID,desc),toRepeat(MID,desc)&&(desc=toRepeat(MID,desc)),desc=desc.replace(/\n/g,"<br>"),$("#recommend").append('<div class="clan-card" data-clan-id='+ID+'><div class="logo">'+logoURL+'</div><div class="card-content"><span class="orange">'+tag+" "+fname+'</span><br>ID：<span class="desc-color">'+ID+"</span>"+date+'<div class="desc-color">'+desc+"</div></div></div>")}indexList=[]}showRecommend()}));